/*
격자 : n x n, 0 ~ 5
0 : 빈 공간
1 : 사무실 구역
2 : 에어컨, 왼쪽 향
3 : 에어컨, 위쪽 향
4 : 에어컨, 오른쪽 향
5 : 에어컨, 아래 향

에어컨이 사무실을 시원하게 하는 과정
1. 에어컨의 바람이 나와서 아래 그림의 나온 수만큼 공기를 시원하게 함
에어컨이 다른 방향을 향하고 있을 때에도 유사한 방법으로 퍼져나감

에어컨 방향이 오른쪽이라할 때 처음 공기가 전파된 위치에서 위쪽 45도, 오른쪽, 아랫쪼 45도 기준으로 퍼지게 되며,
가는 방향에 벽이 있으면 전파가 진행되지 않습니다.

새로운 시원함의 생성은, 모든 에어컨으로부터 나오는 시원함의 합으로 이루어지게 됨
에어컨이 놓여있는 자리에도 시원함이 생길 수 있음

2. 시원한 공기들이 섞이기 시작
시원한 공기들은 서로 인접한 칸들에 대해 시원함이 높은 곳에서 낮은 곳으로 (시원함의 차이 / 4)만큼 전파
이는 모든 칸에 대해 동시에 일어나며, 벽을 사이에 두고 있는 칸끼리는 일어나지 않음에 유의

3. 외벽에 있는 칸에 대해서만 시원함이 1씩 감소
바깥쪽과 맞닿아있는 칸들에 대해서만 시원함이 1씩 감소
단, 이미 시원함이 0이었던 칸이라면, 감소하지 않음

이러한 과정을 한번 거치면 정확히 1분이 흐르게 됨
이 사이클을 모든 사무실에서의 시원함이 전부 k 이상이 될때까지 반복
*/
#define _CRT_SECURE_NO_WARNINGS
#include <iostream>
#include <queue>
using namespace std;

const int MAXN = 20;

int n, m, k; // 격자 크기, 벽의 개수, 원하는 사무실의 시원함 정도
int grid[MAXN + 10][MAXN + 10]; // 사무실과 에어컨
int up_wall[MAXN + 10][MAXN + 10]; // 위 벽
int left_wall[MAXN + 10][MAXN + 10]; // 왼쪽 벽
int coolness[MAXN + 10][MAXN + 10]; // 시원함의 정도
int next_coolness[MAXN + 10][MAXN + 10];

bool visited[MAXN + 10][MAXN + 10];

int dx[4] = {0,1,0,-1};
int dy[4] = {1,0,-1,0};

struct State {
	int x;
		int y;
			int cnt;
			};

			bool isOver() {
				for (int i = 0; i < n; i++) {
						for (int j = 0; j < n; j++) {
									if (grid[i][j] == 1 && coolness[i][j] < k) return false;
											}
												}
													return true;
													}

													void print() {
														cout << "grid" << "\n";
															for (int i = 0; i < n; i++) {
																	for (int j = 0; j < n; j++) {
																				cout << grid[i][j] << " ";
																						}
																								cout << "\n";
																									}
																										cout << "\n";

																											cout << "coolness" << "\n";
																												for (int i = 0; i < n; i++) {
																														for (int j = 0; j < n; j++) {
																																	cout << coolness[i][j] << " ";
																																			}
																																					cout << "\n";
																																						}
																																							cout << "\n";
																																							}

																																							bool inRange(int x, int y) {
																																								return (x >= 0 && x < n && y >= 0 && y < n);
																																								}

																																								void leftAir(int x, int y) {
																																									for (int i = 0; i < n; i++) {
																																											for (int j = 0; j < n; j++) {
																																														next_coolness[i][j] = 0;
																																																}
																																																	}

																																																		for (int i = 0; i < n; i++) {
																																																				for (int j = 0; j < n; j++) {
																																																							visited[i][j] = false;
																																																									}
																																																										}
																																																											queue<State> q;

																																																												q.push({ x, y - 1, 5 });
																																																													visited[x][y - 1] = true;

																																																														while (!q.empty()) {
																																																																State cur = q.front();
																																																																		q.pop();

																																																																				if (cur.cnt == 0) continue;
																																																																						next_coolness[cur.x][cur.y] = cur.cnt;

																																																																								int nx = cur.x + dx[2];
																																																																										int ny = cur.y + dy[2];
																																																																												if (inRange(nx, ny) && !visited[nx][ny] && left_wall[cur.x][cur.y] == 0) {
																																																																															q.push({ nx, ny, cur.cnt - 1 });
																																																																																		visited[nx][ny] = true;
																																																																																				}

																																																																																						nx = cur.x + dx[3] + dx[2];
																																																																																								ny = cur.y + dy[3] + dy[2];
																																																																																										if (inRange(nx, ny) && !visited[nx][ny] && up_wall[cur.x][cur.y] == 0 && left_wall[cur.x + dx[3]][cur.y + dy[3]] == 0) {
																																																																																													q.push({ nx, ny, cur.cnt - 1 });
																																																																																																visited[nx][ny] = true;
																																																																																																		}

																																																																																																				nx = cur.x + dx[1] + dx[2];
																																																																																																						ny = cur.y + dy[1] + dy[2];
																																																																																																								if (inRange(nx, ny) && !visited[nx][ny] && up_wall[cur.x + dx[1]][cur.y + dy[1]] == 0 && left_wall[cur.x + dx[1]][cur.y + dy[1]] == 0) {
																																																																																																											q.push({ nx, ny, cur.cnt - 1 });
																																																																																																														visited[nx][ny] = true;
																																																																																																																}
																																																																																																																	}

																																																																																																																		for (int i = 0; i < n; i++) {
																																																																																																																				for (int j = 0; j < n; j++) {
																																																																																																																							coolness[i][j] += next_coolness[i][j];
																																																																																																																									}
																																																																																																																										}
																																																																																																																										}

																																																																																																																										void upAir(int x, int y) {
																																																																																																																											for (int i = 0; i < n; i++) {
																																																																																																																													for (int j = 0; j < n; j++) {
																																																																																																																																next_coolness[i][j] = 0;
																																																																																																																																		}
																																																																																																																																			}

																																																																																																																																				for (int i = 0; i < n; i++) {
																																																																																																																																						for (int j = 0; j < n; j++) {
																																																																																																																																									visited[i][j] = false;
																																																																																																																																											}
																																																																																																																																												}
																																																																																																																																													queue<State> q;

																																																																																																																																														q.push({ x - 1, y, 5 });
																																																																																																																																															visited[x - 1][y] = true;

																																																																																																																																																while (!q.empty()) {
																																																																																																																																																		State cur = q.front();
																																																																																																																																																				q.pop();

																																																																																																																																																						if (cur.cnt == 0) continue;
																																																																																																																																																								next_coolness[cur.x][cur.y] = cur.cnt;

																																																																																																																																																										int nx = cur.x + dx[3];
																																																																																																																																																												int ny = cur.y + dy[3];
																																																																																																																																																														if (inRange(nx, ny) && !visited[nx][ny] && up_wall[cur.x][cur.y] == 0) {
																																																																																																																																																																	q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																				visited[nx][ny] = true;
																																																																																																																																																																						}

																																																																																																																																																																								nx = cur.x + dx[2] + dx[3];
																																																																																																																																																																										ny = cur.y + dy[2] + dy[3];
																																																																																																																																																																												if (inRange(nx, ny) && !visited[nx][ny] && left_wall[cur.x][cur.y] == 0 && up_wall[cur.x + dx[2]][cur.y + dy[2]] == 0) {
																																																																																																																																																																															q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																		visited[nx][ny] = true;
																																																																																																																																																																																				}

																																																																																																																																																																																						nx = cur.x + dx[0] + dx[3];
																																																																																																																																																																																								ny = cur.y + dy[0] + dy[3];
																																																																																																																																																																																										if (inRange(nx, ny) && !visited[nx][ny] && left_wall[cur.x + dx[0]][cur.y + dy[0]] == 0 && up_wall[cur.x + dx[0]][cur.y + dy[0]] == 0) {
																																																																																																																																																																																													q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																visited[nx][ny] = true;
																																																																																																																																																																																																		}
																																																																																																																																																																																																			}

																																																																																																																																																																																																				for (int i = 0; i < n; i++) {
																																																																																																																																																																																																						for (int j = 0; j < n; j++) {
																																																																																																																																																																																																									coolness[i][j] += next_coolness[i][j];
																																																																																																																																																																																																											}
																																																																																																																																																																																																												}
																																																																																																																																																																																																												}

																																																																																																																																																																																																												void rightAir(int x, int y) {
																																																																																																																																																																																																													for (int i = 0; i < n; i++) {
																																																																																																																																																																																																															for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																		next_coolness[i][j] = 0;
																																																																																																																																																																																																																				}
																																																																																																																																																																																																																					}

																																																																																																																																																																																																																						for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																								for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																											visited[i][j] = false;
																																																																																																																																																																																																																													}
																																																																																																																																																																																																																														}
																																																																																																																																																																																																																															queue<State> q;

																																																																																																																																																																																																																																q.push({ x, y + 1, 5 });
																																																																																																																																																																																																																																	visited[x][y + 1] = true;

																																																																																																																																																																																																																																		while (!q.empty()) {
																																																																																																																																																																																																																																				State cur = q.front();
																																																																																																																																																																																																																																						q.pop();

																																																																																																																																																																																																																																								if (cur.cnt == 0) continue;
																																																																																																																																																																																																																																										next_coolness[cur.x][cur.y] = cur.cnt;

																																																																																																																																																																																																																																												int nx = cur.x + dx[0];
																																																																																																																																																																																																																																														int ny = cur.y + dy[0];
																																																																																																																																																																																																																																																if (inRange(nx, ny) && !visited[nx][ny] && left_wall[nx][ny] == 0) {
																																																																																																																																																																																																																																																			q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																																																																						visited[nx][ny] = true;
																																																																																																																																																																																																																																																								}

																																																																																																																																																																																																																																																										nx = cur.x + dx[3] + dx[0];
																																																																																																																																																																																																																																																												ny = cur.y + dy[3] + dy[0];
																																																																																																																																																																																																																																																														if (inRange(nx, ny) && !visited[nx][ny] && up_wall[cur.x][cur.y] == 0 && left_wall[nx][ny] == 0) {
																																																																																																																																																																																																																																																																	q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																																																																																				visited[nx][ny] = true;
																																																																																																																																																																																																																																																																						}

																																																																																																																																																																																																																																																																								nx = cur.x + dx[1] + dx[0];
																																																																																																																																																																																																																																																																										ny = cur.y + dy[1] + dy[0];
																																																																																																																																																																																																																																																																												if (inRange(nx, ny) && !visited[nx][ny] && up_wall[cur.x + dx[1]][cur.y + dy[1]] == 0 && left_wall[nx][ny] == 0) {
																																																																																																																																																																																																																																																																															q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																																																																																																		visited[nx][ny] = true;
																																																																																																																																																																																																																																																																																				}
																																																																																																																																																																																																																																																																																					}

																																																																																																																																																																																																																																																																																						for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																								for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																											coolness[i][j] += next_coolness[i][j];
																																																																																																																																																																																																																																																																																													}
																																																																																																																																																																																																																																																																																														}
																																																																																																																																																																																																																																																																																														}

																																																																																																																																																																																																																																																																																														void downAir(int x, int y) {
																																																																																																																																																																																																																																																																																															for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																	for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																				next_coolness[i][j] = 0;
																																																																																																																																																																																																																																																																																																						}
																																																																																																																																																																																																																																																																																																							}

																																																																																																																																																																																																																																																																																																								for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																										for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																													visited[i][j] = false;
																																																																																																																																																																																																																																																																																																															}
																																																																																																																																																																																																																																																																																																																}
																																																																																																																																																																																																																																																																																																																	queue<State> q;

																																																																																																																																																																																																																																																																																																																		q.push({ x + 1, y, 5 });
																																																																																																																																																																																																																																																																																																																			visited[x + 1][y] = true;

																																																																																																																																																																																																																																																																																																																				while (!q.empty()) {
																																																																																																																																																																																																																																																																																																																						State cur = q.front();
																																																																																																																																																																																																																																																																																																																								q.pop();

																																																																																																																																																																																																																																																																																																																										if (cur.cnt == 0) continue; // 여기서 return을 하니까 문제가 발생한거 같은데
																																																																																																																																																																																																																																																																																																																												next_coolness[cur.x][cur.y] = cur.cnt;

																																																																																																																																																																																																																																																																																																																														int nx = cur.x + dx[1];
																																																																																																																																																																																																																																																																																																																																int ny = cur.y + dy[1];
																																																																																																																																																																																																																																																																																																																																		if (inRange(nx, ny) && !visited[nx][ny] && up_wall[nx][ny] == 0) {
																																																																																																																																																																																																																																																																																																																																					q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																																																																																																																																																								visited[nx][ny] = true;
																																																																																																																																																																																																																																																																																																																																										}

																																																																																																																																																																																																																																																																																																																																												nx = cur.x + dx[2] + dx[1];
																																																																																																																																																																																																																																																																																																																																														ny = cur.y + dy[2] + dy[1];
																																																																																																																																																																																																																																																																																																																																																if (inRange(nx, ny) && !visited[nx][ny] && left_wall[cur.x][cur.y] == 0 && up_wall[nx][ny] == 0) {
																																																																																																																																																																																																																																																																																																																																																			q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																																																																																																																																																																						visited[nx][ny] = true;
																																																																																																																																																																																																																																																																																																																																																								}

																																																																																																																																																																																																																																																																																																																																																										nx = cur.x + dx[0] + dx[1];
																																																																																																																																																																																																																																																																																																																																																												ny = cur.y + dy[0] + dy[1];
																																																																																																																																																																																																																																																																																																																																																														if (inRange(nx, ny) && !visited[nx][ny] && left_wall[cur.x + dx[0]][cur.y + dy[0]] == 0 && up_wall[nx][ny] == 0) {
																																																																																																																																																																																																																																																																																																																																																																	q.push({ nx, ny, cur.cnt - 1 });
																																																																																																																																																																																																																																																																																																																																																																				visited[nx][ny] = true;
																																																																																																																																																																																																																																																																																																																																																																						}
																																																																																																																																																																																																																																																																																																																																																																							}

																																																																																																																																																																																																																																																																																																																																																																								for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																																																																																										for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																																																																																													coolness[i][j] += next_coolness[i][j];
																																																																																																																																																																																																																																																																																																																																																																															}
																																																																																																																																																																																																																																																																																																																																																																																}
																																																																																																																																																																																																																																																																																																																																																																																}

																																																																																																																																																																																																																																																																																																																																																																																void conditionAir() {
																																																																																																																																																																																																																																																																																																																																																																																	for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																																																																																																			for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																																																																																																						if (grid[i][j] == 2) leftAir(i, j);
																																																																																																																																																																																																																																																																																																																																																																																									else if (grid[i][j] == 3) upAir(i, j);
																																																																																																																																																																																																																																																																																																																																																																																												else if (grid[i][j] == 4) rightAir(i, j);
																																																																																																																																																																																																																																																																																																																																																																																															else if (grid[i][j] == 5) downAir(i, j);
																																																																																																																																																																																																																																																																																																																																																																																																	}
																																																																																																																																																																																																																																																																																																																																																																																																		}
																																																																																																																																																																																																																																																																																																																																																																																																		}

																																																																																																																																																																																																																																																																																																																																																																																																		void mixAir() {
																																																																																																																																																																																																																																																																																																																																																																																																			for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																																																																																																																					for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																																																																																																																								next_coolness[i][j] = 0;
																																																																																																																																																																																																																																																																																																																																																																																																										}
																																																																																																																																																																																																																																																																																																																																																																																																											}

																																																																																																																																																																																																																																																																																																																																																																																																												for (int x = 0; x < n; x++) {
																																																																																																																																																																																																																																																																																																																																																																																																														for (int y = 0; y < n; y++) {
																																																																																																																																																																																																																																																																																																																																																																																																																	next_coolness[x][y] += coolness[x][y];

																																																																																																																																																																																																																																																																																																																																																																																																																				int nx = x + dx[0];
																																																																																																																																																																																																																																																																																																																																																																																																																							int ny = y + dy[0];
																																																																																																																																																																																																																																																																																																																																																																																																																										if (inRange(nx, ny) && left_wall[nx][ny] == 0 && coolness[x][y] > coolness[nx][ny]) {
																																																																																																																																																																																																																																																																																																																																																																																																																														int diff = (coolness[x][y] - coolness[nx][ny]) / 4;
																																																																																																																																																																																																																																																																																																																																																																																																																																		next_coolness[x][y] -= diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																						next_coolness[nx][ny] += diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																									}

																																																																																																																																																																																																																																																																																																																																																																																																																																												nx = x + dx[1];
																																																																																																																																																																																																																																																																																																																																																																																																																																															ny = y + dy[1];
																																																																																																																																																																																																																																																																																																																																																																																																																																																		if (inRange(nx, ny) && up_wall[nx][ny] == 0 && coolness[x][y] > coolness[nx][ny]) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																						int diff = (coolness[x][y] - coolness[nx][ny]) / 4;
																																																																																																																																																																																																																																																																																																																																																																																																																																																										next_coolness[x][y] -= diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																																														next_coolness[nx][ny] += diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																	}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																				nx = x + dx[2];
																																																																																																																																																																																																																																																																																																																																																																																																																																																																							ny = y + dy[2];
																																																																																																																																																																																																																																																																																																																																																																																																																																																																										if (inRange(nx, ny) && left_wall[x][y] == 0 && coolness[x][y] > coolness[nx][ny]) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																														int diff = (coolness[x][y] - coolness[nx][ny]) / 4;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		next_coolness[x][y] -= diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																						next_coolness[nx][ny] += diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																									}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																												nx = x + dx[3];
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																															ny = y + dy[3];
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		if (inRange(nx, ny) && up_wall[x][y] == 0 && coolness[x][y] > coolness[nx][ny]) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																						int diff = (coolness[x][y] - coolness[nx][ny]) / 4;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																										next_coolness[x][y] -= diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																														next_coolness[nx][ny] += diff;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																				}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																							for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																										coolness[i][j] = next_coolness[i][j];
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																												}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													/*
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													2. 시원한 공기들이 섞이기 시작
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													시원한 공기들은 서로 인접한 칸들에 대해 시원함이 높은 곳에서 낮은 곳으로 (시원함의 차이 / 4)만큼 전파
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													이는 모든 칸에 대해 동시에 일어나며, 벽을 사이에 두고 있는 칸끼리는 일어나지 않음에 유의

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													3. 외벽에 있는 칸에 대해서만 시원함이 1씩 감소
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													바깥쪽과 맞닿아있는 칸들에 대해서만 시원함이 1씩 감소
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													단, 이미 시원함이 0이었던 칸이라면, 감소하지 않음
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													*/

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													void reduceAir() {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																														for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																if(coolness[0][j] != 0) coolness[0][j]--;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		for (int i = 1; i < n; i++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																				if (coolness[i][n - 1] != 0) coolness[i][n - 1]--;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																						for (int j = n - 2; j >= 0; j--) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																								if (coolness[n - 1][j] != 0) coolness[n - 1][j]--;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																									}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																										for (int i = n - 2; i >= 1; i--) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																												if (coolness[i][0] != 0) coolness[i][0]--;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													int main() {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																														ios::sync_with_stdio(0); cin.tie(0); cout.tie(0);
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																															//freopen("sample_input.txt", "r", stdin);

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																cin >> n >> m >> k;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	for (int i = 0; i < n; i++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			for (int j = 0; j < n; j++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																						cin >> grid[i][j];
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																								}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																									}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																										for (int i = 0; i < m; i++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																												int x, y, s; cin >> x >> y >> s;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																														x--; y--;

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																if (s == 0) up_wall[x][y] = 1; // s = 0는 위에 벽, s = 1은 왼쪽에 벽
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																		else if (s == 1) left_wall[x][y] = 1;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																				//print();
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					for (int turn = 1; turn <= 100; turn++) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																							//cout << "turn : " << turn << "\n";

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																									//cout << "conditionAir" << "\n";
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											conditionAir();
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																													//print();

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																															//cout << "mixAir" << "\n";
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	mixAir();
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			//print();

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					//cout << "reduceAir" << "\n";
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																							reduceAir();
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																									//print();

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																											if (isOver()) {
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																														cout << turn << "\n";
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																	return 0;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			}
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																				}

																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																					cout << -1 << "\n";
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																						return 0;
																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																						}